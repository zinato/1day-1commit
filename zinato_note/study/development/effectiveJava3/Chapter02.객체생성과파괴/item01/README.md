# ITEM 01 : 생성자 대신 정적 팩토리 메서드를 고려하라

> 정적 팩토리 메소드는 디자인 패턴에서의 팩토리 메서드와 다르다. 디자인 패턴중에는 정적 팩토리 메서드와 일치하는 패턴은 없다.
  
```java
  public static Boolean valueOf(boolean b) {
    return b ? Boolean.TRUE : Boolean.FALSE;
  }
```

## 장점
  
### 1. 이름을 가질 수 있다  

- 생성자는 매개변수와 생성자 자체만으로는 반환될 객체의 특성을 잘 표현할 수 없다.
- 하나의 시그니처로는 생성자를 하나만 만들 수 있다.
- 정적 팩토리 메서드는 이름을 가질 수 있으므로 명확하게 객체의 의미를 알 수 있다.
- API 작성시에도 엉뚱한 것을 호출하는 실수를 줄일 수 있다.
- 한 클래스에 시그니처가 같은 생성자가 여러 개 필요하면 정적 팩토리 메서드로 바꾸고 각각의 차이를 잘 나타내는 이름을 짓자.  
  
### 2. 호출될 때마다 인스턴스를 새로 생성하지 않아도 된다  
  
- 위 예제 코드인 Boolean.valueOf(boolean) 메서드는 객체를 아예 생성하지 않는다.
- (생성 비용이 큰) 같은 객체가 자주 요청되는 상황이라면 성능을 올릴 수 있다.
- 반복되는 요청에 같은 객체를 반환하는 식으로 언제 어느 인스턴스를 살아 있게 할지를 철저히 통제할 수 있다.
  - 이런 클래스를 ***인스턴스 통제 클래스(instance-controlled)*** 라고 한다.
- 인스터스를 ***통제*** 하는 이유는?
  1. 클래스를 싱글턴(singleton)으로 만들 수 있다.
  2. 인스턴스화 불가(noninstantiable)로 만들 수 있다.
  3. 불변 값 클래스에서 동치인 인스턴스가 단 하나뿐임을 보장할 수 있다. (a==b 일때만 a.equals(b) 성립)
  4. 플라이웨이트(Flyweight pattern)의 근간
  5. 열거타입은 인스턴스가 하나만 만들어짐을 보장
  
### 3. 반환 타입의 하위 타입 객체를 반환할 수 있는 능력이 있다  
  
- 반환할 객체의 클래스를 자유롭게 선택할 수 있는 엄청난 유연성을 가질 수 있다.
- 구현 클래스를 공개하지 않고 객체를 반환할 수 있어 API를 작게 유지할 수 있다.
- 인터페이스를 정적 팩토리 메서드의 반환 타입으로 사용하는 인터페이스 기반 프레임워크를 만드는 핵심 기술이기도 하다.
- java.util.Collections에서 정적 팩토리 메서드를 통해 구현하여 API 외견을 훨씬 작게 만들 수 있었다.
  - API를 사용하기 위해 익혀야 하는 개념의 수와 난이도도 낮아진다.
- 자바 8 부터 인터페이스도 정적 메서드를 가질 수 있기 때문에 인스턴스화 불가 동반 클래스를 가질 이유가 별로 없다.
  - 동반 클래스에 두었던 public 정적 멤버들 상당수를 그냥 인터페이스 자체에 두면 된다.
- 자바 9 에서는 private 정적 메서드까지 허용하지만 static field와 static class는 public이어야 한다.

### 4. 입력 매개변수에 따라 매번 다른 클래스의 객체를 반환할 수 있다  
  
- 반환 타입의 하위 타입이기만 하면 어떤 클래스의 객체를 반환하든 상관 없다.
- 클라이언트는 팩토리가 건네주는 객체가 어느 클래스의 인스턴스인지 알 수도 없고 알 필요도 없다.  

### 5. 정적 팩토리 메서드를 작성하는 시점에는 반환할 객체의 클래스가 존재하지 않아도 된다
  
- 이런 유연함을 사용하여 서비스 제공자 프레임워크(service provider framework)를 만들 수 있다.
  - 대표적인 예로 JDBC가 있다.
- 서비스 제공자 프레임워크는 3개의 핵심 컴포넌트로 이뤄진다.
  1. 구현체의 동작을 정의하는 서비스 인터페이스(service interface)
  2. 제공자가 구현체를 등록할 때 사용하는 제공자 등록 API(provider registration API)
  3. 클라이언트가 서비스의 인스턴스를 얻을 뗴 사용하는 서비스 접근 API(service access API) : 주인공
      - 서비스 접근 API가  __유연한 정적 팩토리__ 의 실체
  4. 서비스 제공자 인터페이스라는 네번째 컴포넌트가 쓰이기도 한다.  
- JDBC를 예로 설명해보자.
  1. 서비스 인터페이스 : Connection
  2. 제공자 등록 API : DriverManager.registerDriver
  3. 서비스 접근 API : Driver.getConnection
  4. 서비스 제공자 인터페이스 : Driver
- 서비스 제공자 프레임워크 패턴에는 여러 변형이 있다.
  - 의존성 주입(depedency injection)
  - 브릿지 패턴 (Bridge patter)

## 단점

### 1. 상속을 하려면 public이나 protected 생성자가 필요하니 정적 팩토리 메서드만 제공하면 하위 클래스를 만들 수 없다

- 컬렉션 프레임워크의 유틸리티 구현 클래스들은 상속할 수 없다.

### 2. 정적 팩토리 메서드는 프로그래머가 찾기 어렵다

- 개발자가 잘 찾을 수 있도록 API 문서에 잘 써놔야 한다 :)
<pre><code>
  //from: 매개변수를 하나 받아서 해당 타입의 인스턴스를 반환하는 형변환 메서드
  Date d = Date.from(instant);
  //of : 여러 매개변수를 받아 적합한 타입의 인스턴스를 반환하는 집계 메서드
  Set<Rank> faceCards = EnumSet.of(JACK, QUEEN, KING);
</code></pre>

> ### 정리
> 정적 팩토리 메서드와 public 생성자의 장단점을 잘이해하고 사용해야 한다.
> 그래도 정적 팩토리 메서드를 사용하는 것이 더 유리한 경우가 많으므로 ***무작정 public 생성자를 제공하던 습관을 고치자!***
